---
title: 计算机网络原理之【流量控制】
categories:
- 网络原理
tags:
- 网络原理
---

TCP 流量控制机制！

<!--more-->



### 一、什么是流量控制？

> 网络流量控制（Network traffic control）是利用软件或硬件方式来实现对网络数据流量进行控制的一种措施。



### 二、为什么要进行流量控制？

如果发送者发送数据过快，接收者来不及接收，这时候接收方只能把处理不过来的数据存在缓存区里（失序的数据包也会被存放在缓存区里。如果发送端继续发送数据，那么多余的数据丢失掉。为了避免这种情况，所以需要对发送端的流量进行控制，让其发送速率和接收速率保持平衡。



### 三、如何对流量进行控制？

#### 3.1 数据包的发送过程

发送端每发送一个数据包接收端就会进行相应，返回**确认报文**用来告诉发送端这个数据包已经收到，可以发送下一个数据包了。



#### 3.2  流量控制

接收端的接收量是由缓存大小决定的，也就是决定了发送端可以发送数据包的大小。如果发送端每发送一个数据包，接收端接收到之后就告诉发送端自己的缓存大小，在发送端下一次发送数据的时候就知道接收端还有多大的空间，从而调整了发送的窗口大小。

> 我们把上述缓存区剩余的大小称之为接收窗口大小。用 win 表示接收端的窗口大小。

当发送方收到接收窗口的大小为 0 时，发送方就会停止发送数据，防止出现大量丢包情况的发生。



### 四、 发送端什么时候再发送数据？

当发送方收到接收窗口的大小为 0 时，发送方就会停止发送数据，那和接收端没有通信了，怎么再次发送数据呢？





#### 4.1 策略一

当接收方处理好数据，接受窗口 win > 0 时，接收方发个通知报文去通知发送方，告诉他可以继续发送数据了。当发送方收到窗口大于0的报文时，就继续发送数据。

> 问题：如果接收端发送的数据，在网络中丢失导致发送端接受不到怎么办？那双方只能进行等待，白白浪费了发送端和接收端的资源。



#### 4.2  策略二

当发送方收到接受窗口 win = 0 时，这时发送方停止发送报文，并且同时开启一个定时器，每隔一段时间就发送一个测试报文询问对方，能否给你发送数据了？如果你能给我发送数据，就告诉我窗口的大小。如果还是 win = 0，发送端则重新刷新计时器。





### 五、小结

1、这里说明下，由于TCP/IP支持全双工传输，因此通信的双方都拥有两个滑动窗口，一个用于接受数据，称之为**接收窗口**；一个用于发送数据，称之为**拥塞窗口(**即发送窗口)。指出接受窗口大小的通知我们称之为窗口通告。



**2、接收窗口的大小固定吗？**



在早期的TCP协议中，接受接受窗口的大小确实是固定的，不过随着网络的快速发展，固定大小的窗口太不灵活了，成为TCP性能瓶颈之一，也就是说，在现在的TCP协议中，**接受窗口**的大小是根据某种算法动态调整的。



**3、接受窗口越大越好吗？**



接受窗口如果太小的话，显然这是不行的，这会严重浪费链路利用率，增加丢包率。那是否越大越好呢？答否，当接收窗口达到某个值的时候，再增大的话也不怎么会减少丢包率的了，而且还会更加消耗内存。所以接收窗口的大小必须根据网络环境以及发送发的的拥塞窗口来动态调整。



**4、发送窗口和接受窗口相等吗？**



接收方在发送确认报文的时候，会告诉发送发自己的接收窗口大小，而发送方的发送窗口会据此来设置自己的发送窗口，但这并不意味着他们就会相等。首先接收方把确认报文发出去的那一刻，就已经在一边处理堆在自己缓存区的数据了，所以一般情况下接收窗口 >= 发送窗口。





























