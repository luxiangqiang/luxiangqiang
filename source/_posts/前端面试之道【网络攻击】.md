---
title: 前端面试之道【网络攻击】
categories: 
- 前端
- 面试
tags: 
- 前端
- 面试
---



常见的网络攻击！

<!--more-->



## 一、XSS 攻击

#### 1、XSS 是什么

> XSS 攻击称为跨站脚本攻击，是一种代码注入的攻击。攻击者通过向目标网站注入恶意脚本，使之在浏览器中运行。利用脚本获取到用户的信息。

XSS 常见几种注入方法：

- 以 javascript 标签的形式注入。
- 在内联 javascript 中，拼接的数据突破了原本的限制（字符串、变量等）
- 在属性标签中，恶意内容包含引号，突破属性值的限制，注入其他属性。
- 在标签的 href、src 等属性中，包含 js 可执行代码。
- 在 onload、onerror、onclick 等事件中，注入不受控制的代码。



#### 2、XSS 攻击的分类

- 存储型 XSS
- 反射型 XSS
- DOM型 XSS



##### ▉ 存储型 XSS

> 最危险的一种跨站脚本攻击，危害比反射性和DOM型都要大，因为不需要用户手动触发。**恶意代码存储在数据库中**。

1）攻击者将恶意代码提交至目标网站的数据库中。

2）用户打开网站，网站将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。

3）浏览器将服务器返回的 HTML 进行解析，恶意代码被执行。

4）恶意代码就会盗取用户信息向攻击者网站发送隐私数据。



##### ▉ 反射型 XSS

> 需要用户主动打开 URL 。**恶意代码存储在 URL 中**。常见的用于 URL 传递参数的功能，如：网站搜索、跳转等。

1）攻击者伪造包含恶意代码的URL。

2）用户打开恶意的URL，服务端将恶意的 `URL` 代码取出拼接在` HTML` 后返回给浏览器。

3）用户浏览器解析请求，恶意代码得到执行。

4）恶意代码就会盗取用户信息向攻击者网站发送隐私数据。



#####  ▉DOM 型 XSS

> DOM 型 XSS 攻击中，取出和执行**恶意代码由浏览器端完成**，属于前端 `JavaScript` 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。 

1）攻击者伪造包含恶意代码的 `URL`。

2）用户打开恶意的 `URL`。

3）前端 `Javascript` 取出 `URL` 中的恶意代码**由浏览器完成**，属于前端 `javascript` 自身的安全漏洞，触发XSS **靠的是浏览器端的DOM解析** 。

4）恶意代码就会盗取用户信息向攻击者网站发送隐私数据。



#### 3、防御 XSS

#####  ▉ 常用的防御方法

> 一般页面输入的地方会存在 XSS 攻击的危险。

- **httpOnly:** 在 `cookie` 中设置 `HttpOnly` 属性后，js 脚本无法读取到 `Cookie` 信息。
- **输入过滤：**用于对输入格式的检查（邮箱、电话号码等）。前后台多要进行过滤检查，因为攻击者完全可以绕过前端直接利用接口对后端发送设置。
- **白名单：**名单控制允许的 `HTML `标签及各标签的属性 。
- **转义 HTML：**如果拼接 `HTML` 是必要的，对于引号，尖括号，斜杠进行转义（可以借助转义库）。

```javascript
function escape(str) {
  str = str.replace(/&/g, '&amp;')
  str = str.replace(/</g, '&lt;')
  str = str.replace(/>/g, '&gt;')
  str = str.replace(/"/g, '&quto;')
  str = str.replace(/'/g, '&#39;')
  str = str.replace(/`/g, '&#96;')
  str = str.replace(/\//g, '&#x2F;')
  return str
}
```



#####  ▉ 预防存储型和反射性 XSS 攻击

> 这两种攻击一般在服务器端取出恶意代码，拼接到 `HTML` 中，然后被浏览器所执行。



**1、改成纯前端渲染，使代码和数据分离。**

> **作用：**明确告诉浏览器，要设置的内容是文本（`.innerText`），还是属性（`.setAttribute`），还是样式（`.style`）等等。浏览器不会被轻易的被欺骗，执行预期外的代码了 。
>
> **缺点：**需要避免 DOM 型的 XSS 攻击。
>
> 1）浏览器先加载一个静态 `HTML`，此 `HTML` 中不包含任何跟业务相关的数据。
>
> 2）然后浏览器执行 `HTML` 中的 `JavaScript`。
>
> 3）`JavaScript` 通过 `Ajax` 加载业务数据，调用 `DOM API` 更新到页面上 



**2、对 HTML 做充分的转义。**

> 在很多内部、管理系统中，采用纯前端渲染是非常合适的。但对于性能要求高，或有 SEO 需求的页面，我们仍然要面对拼接 HTML 的问题,这时就需要对HTML进行充分的转义。 



#####  ▉ 预防 DOM 型 XSS 攻击

> 由于前端的 javascript 代码本身不够严谨，把不可信的数据当做代码执行了。



**1、HTML 插入数据**

> 在使用 `.innerHTML`、`.outerHTML`、`document.write()` 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用 `.textContent`、`.setAttribute()` 等 



**2、DOM 内联监听**

> DOM 中的内联事件监听器，如 `location`、`onclick`、`onerror`、`onload`、`onmouseover` 等，`<a>` 标签的 `href` 属性，JavaScript 的 `eval()`、`setTimeout()`、`setInterval()` 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。

```javascript
<!-- 内联事件监听器中包含恶意代码 -->
<img onclick="UNTRUSTED" onerror="UNTRUSTED" src="data:image/png,">

<!-- 链接内包含恶意代码 -->
<a href="UNTRUSTED">1</a>

<script>
// setTimeout()/setInterval() 中调用恶意代码
setTimeout("UNTRUSTED")
setInterval("UNTRUSTED")

// location 调用恶意代码
location.href = 'UNTRUSTED'

// eval() 中调用恶意代码
eval("UNTRUSTED")
</script>

```



## 二、CSRF 跨站请求伪造

### 2.1 跨站请求伪造（CSRF）

> 跨站伪造请求（Cross-site request forgery ），缩写为 CSRF。冒充用户发起请求（在用户不知情的情况下）， 完成一些违背用户意愿的事情（如修改用户信息，删初评论等）。 



#### 1、攻击原理

> 攻击者通过技术手段欺骗用户的浏览器去访问一个曾经认证过的网站，所以用户不用进行重新认证，这是一个用户身份验证的一个漏洞：**简单身份认证只保证请求来自某个用户的浏览器，确不能保证请求的本身是用户自愿发出的。**攻击者诱导用户在刚访问不久的网站中点击设定的链接（本页的论坛、博客等自动生成的链接内容）。



#### 2、防御措施

###### ▉ 检查 Referer 字段

> HTTP 头有一个 `Referer` 字段，用来标记请求来源于哪个地址。`Referer` 字段应和请求的地址位于同一域名下。 服务器在处理请求的时候，可以判断该字段是否位于正确的源地址下发送的请求。如果是 CSRF 攻击，该字段会包含恶意的网址。
>
> **局限性：**设置 `Referer` 有本身的局限性，攻击者可以篡改 `Referer` 字段来达到攻击的目的。



###### ▉  Token 验证

> CSRF 的本质是在于攻击者欺骗自己去访问设置的地址，如果在请求数据的时候，用户不把信息保存到浏览器的 `Cookie` 中，那么攻击者无法获取数据校验，从而不能进行 CSRF 攻击。
>

- **第一步：**后端随机产生一个 `token`，把这个 `token` 保存到 `session` 状态中；同时后端把这个 `token` 交给前端页面；
- **第二步：**前端页面提交请求时，把 `token` 加入到请求数据或者头信息中，一起传给后端；
- **第三步：**端验证前端传来的 `token` 与 `session` 是否一致，一致则合法，否则是非法请求。



## 四、DNS 攻击

#### 1、什么是 DNS 攻击？

> 利用 DNS（域名系统）中的漏洞，发起 DNS 攻击。



###### ▉ DNS 的工作原理

> 将用户输入的域名转换成相对应的 IP 地址。

- DNS 首先搜索缓存中是否存在该域名的 IP 地址。
- 如果找不到该域名的地址，就到 DNS 服务器查找该域名准确的 IP 地址。
- DNS 一直循环工作，DNS 服务器之间可以相互查询到域名的 IP 地址的DNS 服务器。
- DNS 一旦找到 IP 地址，就将当前的 IP 地址返回给请求的程序，将其存储缓存中。



###### ▉ 如何利用 DNS 攻击

> 1）DNS 不太注重安全问题，所以容易被攻击者发起 DNS 攻击。攻击者利用一种方式来用恶意的 IP 地址替换 DNS 解析的域名的 IP 地址，那么用户发送的数据发送到这个攻击者替换的 IP 假地址中去。
>
> 2）DNS 服务器配置不记得它的默认配置，所以利用这一漏洞进行攻击。



###### ▉ DNS 的攻击类型

- **零日攻击：**利用 DNS 服务器软件和协议堆栈中未知的漏洞。
- **Fast Flux DNS ： **以高频率交换 DNS 记录以重定向 DNS 请求，也有利于攻击者避免检测。
- **DNS 欺骗：**攻击者通过用服务器缓存中的伪造 IP 地址替换授权的 IP 地址来破坏整个DNS服务器。通过这种方式，他们将整个流量重定向到恶意网站并收集重要信息。 





## 五、DDOS 攻击

> DDoS 攻击称为**分布式拒绝服务攻击**。 通过多台计算机对 DNS 服务器发送大量的请求，达到目标的 DNS 服务器无法进行正常队请求进行解析回应的目的。DDoS 攻击可能导致整个 DNS 服务器崩溃并使用户无法访问 Web。





