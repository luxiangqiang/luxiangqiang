---
title: 数据结构与算法之美【图的表示】
categories:
- 数据结构
tags:
- 数据结构
password: 小鹿
copyright: true
---



如何存储微博、微信等社交网站中的好友关系？

<!--more-->

### 一、图的基本知识

#### 1、什么是图？

> 树的元素称为**节点**，**图**中的元素叫做**顶点**。图中的顶点可以与任意其他顶点建立连接关系，叫做**边（edge）。**跟顶点连接的边的条数，就叫做顶点的**度**。



#### 2、图的分类

> 根据图有无方向，我们分为**有向图**和**无向图**。

**1）有向图：**把度分为**入度（有多少条边指向这个顶点）**和**出度（有多少条边指向其他顶点）**。

**2）无向图：**没有方向的图称为无向图。

**3）带权图：**每条边都有一个权重的图为带权图。



#### 3、图的实际例子

> **1）微信：**互相加为好友，就添加一条边，微信好友之间的关系可以用一张**无向图**来表示。
>
> **2）微博：**单向关注或互相关注，微博好友之间的关系可以用有向图来表示。
>
> **3）QQ：**不仅是好友关系，还有记录好友之家的亲密关系以及用户的亲密度。



### 二、如何存储图？

#### 1、邻接矩阵存储法

> 基于数组实现的空间换时间思想。



###### ▉ 图示

![](/images/图的存储.png)

###### ▉ 实现

> 1）对于无向图来说，如果顶点 **i** 与顶点 **j** 之间**有边**，就将**A[i]\[j]** 和 **A[j]\[i]** 标记为 **1**；
>
> 2）对于有向图来说，如果顶点 i 到顶点 j 之间，有一条箭头从**顶点 i 指向顶点 j** 的边，就将 **A[i]/[j] 标记为 1**。如果有一条箭头从顶点 j 指向顶点 i 的边，我们就将 A[j]/[i] 标记为 1 
>
> 3）对于带权的图，数组中就存储相应的权重。



###### ▉ 优点

> **1）**邻接矩阵存储方式简单、直接，因为基于数组，所以获取两边的顶点关系的时，就非常高效。
>
> **2）**计算高效，可以将图转化为矩阵进行计算。如：求最短路径问题：[Floyd-Warshall 算法](https://zh.wikipedia.org/wiki/Floyd-Warshall%E7%AE%97%E6%B3%95)。
>
> 



###### ▉ 缺点

> 比较浪费空间。
>
> **分析：**
>
> **1） **对于无向图来说，A[j]\[i] 和 A[i]\[j] 存储的都是 1，实际上存储一个就可以了，对角线只不过是白白浪费了内存空间。
>
> **2）**如果存储稀疏图（顶点多，边不多），所以邻接矩阵更浪费空间。



#### 2、邻接表存储方法

> 基于链表实现的时间换空间思想。



###### ▉ 图示

![](/images/邻接表.png)



###### ▉ 实现

> 邻接表有点像（[链接：散列表]()），每个顶点对应一条链表，链表中存储的是这个顶点相连接的其他顶点。



###### ▉ 优点

> 基于链表的邻接表，可以有效节约内存空间。



###### ▉ 缺点

> 链表存储对缓存不友好，所有在查询两个节点之间的关系就不是那么高效了。链表过长导致查询耗时过长，可以将链表换换成其他的数据结构。



###### ▉ 优化

> 如果上述的链表过长，导致查询数据太过于耗时，为了提高效率，可以将链表转换成更高效的数据结构，比如[平衡二叉树(红黑树)]()、[跳表]()、[散列表]()、[二叉查找树]()。还可以转化成有序的动态数组，通过[二分查找]()的方法来快速定位两个顶点是否存在边。



### 三、本节思考：怎么存储微博、微信中的好友关系？

#### 1、问题：

> 要实现微博用户功能。

- 判断用户 A 是否关注了用户 B；
- 判断用户 A 是否是用户 B 的粉丝；
- 用户 A 关注了用户 B；
- 用户 A 取消关注了用户 B；
- 根据用户首字母进行排序，分页获取用户的粉丝列表；
- 根据用户名称的首字母排序，分页获取用户的关注列表；



#### 2、问题分析

###### ■ 判断用户 A 是否关注了用户 B。

> **挂钩数据结构：**微博是一个大的社交网络，是一张稀疏图，存储方式选择邻接表。



###### ■ 判断用户 A 是否是用户 B 的粉丝。

> **灵活运用：**一个邻接表只能知道用户关注了哪些，而不知道自己有哪些粉丝，应该怎么做？加一个逆邻接表用来存储一个用户有哪些粉丝。



###### ■ 微博人数太多，邻接表导致两个用户关系的查询慢 

> **数据结构的缺点：**将邻接表中的链表改为支持快速增删改查的数据结构平衡二叉树、跳表、散列表、二叉查找树、基于数组动态数据的二分查找。



###### ■ 根据用户首字母进行排序

> **问题特点精选：**用户名称的首字母来排序的，使用[跳表]()来实现。



#### 3、性能分析

###### ■ 选用的数据结构

> [跳表性能分析：]()跳表支持快速增删改查，非常高效，时间复杂度是O(logn)，空间复杂度较高，是 O（n）。但是跳表存储本来就是有序的，所以分页获取粉丝列表或关注列表就非常高效。



###### ■ 内存消耗（数据规模）

> **1、小规模**：数据（几万，几十万），直接加载到内存中去。
>
> **2、大规模： **数据（上亿级）。



▍**方法一：内存**

> 利用[哈希数据分片]()的方式进行存储，存储到不同的机器。

**方法二：外存**

> 外部存储宽裕，因为数据库是我们经常用来持久化存储关系数据的，所以考虑数据库的一种方式。表可以存储两个用户之间对应的关系，为了高效的支持前边的操作，就用[数据库索引]()，对字段都建立索引。



### 四、扩展思考

##### 1、微信这种无向图怎么存储?

> 



##### 2、关于图的实例还有哪些？

> **多对多：**地图、网络、电话。











