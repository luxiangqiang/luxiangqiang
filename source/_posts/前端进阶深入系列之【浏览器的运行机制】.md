---
title: 前端进阶深入系列之【浏览器的运行机制】
categories: 
- 前端
- javascript
- 前端深入系列
tags: 
- 前端
- javascript
- 前端深入系列 
---

深入浅出 JS 的运行机制！

<!--more-->



### 一、区分进程和线程

> CPU 的作用是主要是解释计算机的指令以及处理计算机软件中的数据。

- **进程：**进程是 CPU **资源分配**的最小单位，系统会为每个进行分配内存空间。

- **线程：**线程是 CPU **调度**的最小单位（线程是建立在进程的基础上的一次程序运行单位，一个进程由多个线程组成）。



### 二、浏览器是多进程的

> 1、浏览器之所以能够运行，是因为系统给它的进程分配了资源（cpu、内存）。
>
> 2、浏览器是多进程的，每打开一个 Tab 页，相当于创建了一个独立的浏览器进程。
>
> 3、浏览器有时可以将多个进程合并，比如打开多个空白页，将这些空白页合成一个进程。



#### 1、浏览器有哪些进程？

- **Browser 进程：**

  > 浏览器的主进程（负责协调、主控），只有一个

  - 负责浏览器界面显示，与用户交互。如前进，后退等；
  - 负责各个页面的管理，创建和销毁其他进程；
  - 将Renderer进程得到的内存中的Bitmap，绘制到用户界面上；
  - 网络资源的管理，下载等

- **第三方插件进程：**

  > 每种类型的插件对应一个进程，仅当使用该插件时才创建。

- **GPU 进程：**

  > 用于 3D 绘制等；

- **浏览器渲染进程（浏览器内核）：**

  > 默认每个Tab页面一个进程，互不影响。

  - 页面渲染，脚本执行，事件处理等



#### 2、浏览器多进程的优势？

> 多进程的浏览器资源消耗有点大，难道空间换时间思想。**如果浏览器是单进程，那么某个Tab页崩溃了，就影响了整个浏览器，体验有多差；同理如果是单进程，插件崩溃了也会影响整个浏览器；**

- 避免单个页面崩溃影响整个浏览器；
- 避免第三方插件崩溃影响整个浏览器；
- 多进程利用多核优势；
- ......



#### 3、重点：浏览器的内核（渲染进程）

> 前端浏览器最重要的点就是**渲染进程**，而且渲染进程是是多线程的。页面的渲染、js 的执行、时间的想都会在这个进程内进行。



渲染进程包括哪些线程：

##### ① GUI 渲染线程

- 负责渲染浏览器界面，解析HTML，CSS，构建 DOM 树和 RenderObject 树，布局和绘制等。
- 当界面需要重绘（Repaint）或由于某种操作引发回流(reflow)时，该线程就会执行。
- GUI渲染线程与JS引擎线程是互斥的，当 JS 引擎执行时 GUI 线程会被挂起，GUI 更新会被保存在一个队列中等到 JS 引擎空闲时立即被执行。

##### ② JS 引擎线程

- 也称为 JS 内核，负责处理 Javascript 脚本程序（V8 引擎）。
- JS 引擎线程负责解析 Javascript 脚本，运行代码。
- JS引擎一直等待着任务队列中任务的到来，然后加以处理，一个Tab页（renderer进程）中无论什么时候都只有一个 JS 线程在运行 JS 程序。
- GUI 渲染线程与 JS 引擎线程是互斥的，所以如果 JS 执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞。

##### ③ 事件触发线程

- 属于浏览器的线程而不是 js 引擎，用来控制事件循环。
- 当 JS 引擎执行代码块如 setTimeOut 时，会将对应任务添加到事件线程中。
- 当对应的事件符合触发条件被触发时，该线程会把事件添加到待处理队列的队尾，等待JS引擎的处理。
- 由于JS的单线程关系，所以这些待处理队列中的事件都得排队等待JS引擎处理（当JS引擎空闲时才会去执行）。

##### ④ 定时触发器线程

- `setInterval`与`setTimeout`所在线程。
- 浏览器定时计数器并不是由 JavaScript 引擎计数的（因为JavaScript引擎是单线程的, 如果处于阻塞线程状态就会影响记计时的准确）。
- 通过单独线程来计时并触发定时（计时完毕后，添加到事件队列中，等待JS引擎空闲后执行）。
- W3C在HTML标准中规定，规定要求 setTimeout 中低于 4ms 的时间间隔算为 4ms。

##### ⑤ 异步 http 请求线程

- 在 XMLHttpRequest 在连接后是通过浏览器新开一个线程请求。
- 将检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将这个回调再放入事件队列中。再由 JavaScript 引擎执行。





